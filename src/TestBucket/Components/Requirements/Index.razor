@attribute [Authorize()]
@page "/{TenantId}/Requirements"
@using Humanizer
@using TestBucket.Components.Layout
@using TestBucket.Components.Requirements.Controls
@using TestBucket.Domain.Requirements.Models
@using TestBucket.Domain.Teams.Models
@layout AppLayout

<TenantRedirect />

<MudSplitter Class="container-fill" Bordered="false" Dimension="25" EnableMargin="false">
    <StartContent>
        <RequirementTreeView OnSpecificationClicked="OnSpecificationClicked" OnRequirementClicked="OnRequirementClicked" />
    </StartContent>

    <EndContent>
        <MudStack Class="container-fill">

            @if (_specification is not null)
            {
                <RequirementSpecificationEditor Specification="@_specification"/>
            }
            else if (_requirement is not null)
            {
                <RequirementEditor Requirement="@_requirement" />
            }
            else
            {
                <MudItem Class="pa-2">
                    <UploadRequirementSpecification/>
                </MudItem>
            }
        </MudStack>
    </EndContent>
</MudSplitter>

@code {
    [Parameter] public string TenantId { get; set; } = "";
    [CascadingParameter] TestProject? Project { get; set; }
    [CascadingParameter] Team? Team { get; set; }

    private Team? _team;
    private TestProject? _project;
    private RequirementSpecification? _specification;
    private Requirement? _requirement;
    private RequirementSpecificationFolder? _requirementFolder;

    private Task OnSpecificationClicked(RequirementSpecification specification)
    {
        _requirementFolder = null;
        _requirement = null;
        _specification = specification;
        return Task.CompletedTask;
    }
    private Task OnRequirementClicked(Requirement requirement)
    {
        _requirementFolder = null;
        _requirement = requirement;
        _specification = null;
        return Task.CompletedTask;
    }

    protected override void OnParametersSet()
    {
        if (_project != Project || _team != Team)
        {
            _project = Project;
            _team = Team;
        }
    }
}
