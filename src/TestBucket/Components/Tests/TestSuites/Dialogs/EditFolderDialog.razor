@attribute [Authorize(Roles = "SUPERADMIN")]
@inject TestSuiteController testSuiteService
@inject IStringLocalizer<SharedStrings> loc

@if (Folder is not null)
{
    <EditForm Model="@Folder" OnValidSubmit="async () => await OnValidSubmitAsync()">
        <MudDialog DefaultFocus="DefaultFocus.FirstChild">
            <TitleContent>@Folder.Name</TitleContent>
            <DialogContent>
                <MudStack>
                    <MudStack Spacing="3">
                        <Field>
                            <FieldHeader>Name</FieldHeader>
                            <MudTextField Variant="Variant.Outlined" @bind-Value="Folder.Name"></MudTextField>
                        </Field>

                        <MudDivider/>
                        
                        <Field>
                            <FieldHeader>Color</FieldHeader>
                            <MudColorPicker Variant="Variant.Outlined" Label="Color" @bind-Text="Folder.Color" Style="@($"color: {Folder.Color};")" Placeholder="Select Color" />
                        </Field>
                        
                        <Field>
                            <FieldHeader>Icon</FieldHeader>
                            <IconPicker @bind-Icon="Folder.Icon" />
                        </Field>
                    </MudStack>
                </MudStack>
            </DialogContent>

            <DialogActions>
                <MudButton ButtonType="ButtonType.Submit" Color="Color.Primary">@loc["ok"]</MudButton>
                <MudButton OnClick="Close">@loc["cancel"]</MudButton>
            </DialogActions>
        </MudDialog>
    </EditForm>
}

@code {
    [Parameter] public TestSuiteFolder? Folder { get; set; }

    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = default!;

    private void Close()
    {
        MudDialog.Close();
    }

    private async Task OnValidSubmitAsync()
    {
        if (Folder is not null)
        {
            await testSuiteService.SaveTestSuiteFolderAsync(Folder);
        }

        MudDialog.Close();
    }
}